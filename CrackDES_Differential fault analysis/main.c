#include <stdio.h>
#include <stdlib.h>
#include <ctype.h>
#include <math.h>
#include <time.h>
#include "des.h"
int IPtext[64]={0};
int IPtextError[64]={0};
int R16[32]={0},R16Error[32]={0},L16Error[32]={0};
int static L16[32]={0};
int Exp[48]={0}, ExpErreur[48]={0};
int Split_R15_Error[6]={0},Split_R15[6]={0};
int After_Box[4]={0},After_Box_Error[4]={0};
int Split_Chiffre[4]={0};
int Permute_Xor_Chiffre[32]={0},XOR_Chiffre[32]={0}, Inverse_XOR_Chiffre[32]={0};
int XOR_After_Box[4]={0};
int cle1[32][6],cle2[32][6],cle3[32][6],cle4[32][6],cle5[32][6],cle6[32][6],cle7[32][6],cle8[32][6];
int i_1=0, i_2=0,i_3=0,i_4=0,i_5=0,i_6=0,i_7=0,i_8=0;
int sanserror[]={1,1,0,0,1,0,1,0,0,0,1,1,1,1,1,0,0,0,1,0,0,0,1,1,0,0,0,0,1,0,0,0,0,1,0,1,0,0,0,1,1,0,0,1,1,0,1,1,0,1,1,1,0,0,1,1,0,1,1,0,1,1,0,1};
int K16[48] = {0}, K[64]= {0}, TEMP_C1[64],K8[8],TEMP_C2[56],TEMP_Shift[56];

int chiffre[32][64]={
    {1,1,0,0,1,0,0,0,0,0,1,0,1,1,1,1,0,0,1,0,0,0,1,1,0,0,0,0,1,1,0,0,0,1,0,1,0,0,0,1,1,0,0,1,1,0,1,0,0,1,1,1,0,0,1,1,0,1,1,0,1,0,0,1},
    {1,1,0,0,1,0,1,0,0,0,1,0,1,1,0,0,0,0,1,0,0,0,1,1,0,1,0,0,1,1,0,0,0,1,0,1,0,0,0,1,1,0,0,1,1,0,1,1,0,1,1,1,0,0,1,1,0,1,1,0,1,1,0,1},
    {1,1,0,0,1,0,1,0,0,0,1,1,1,1,1,0,0,0,1,0,0,0,0,1,0,0,0,0,1,1,0,0,0,1,0,1,0,0,0,1,1,0,0,1,1,0,1,0,0,1,1,1,0,0,1,1,0,1,1,0,1,1,0,1},
    {1,1,0,0,1,0,1,0,0,1,1,1,1,1,1,0,0,0,1,0,0,0,1,1,0,1,0,0,1,0,1,0,0,1,0,0,0,0,0,1,1,0,0,1,1,0,1,0,0,1,1,1,0,0,1,1,0,1,1,0,1,1,0,1},
    {1,1,0,0,1,0,1,1,0,1,1,0,1,1,1,0,0,0,1,0,0,1,1,1,0,0,0,0,1,1,0,0,0,1,0,0,0,0,1,1,1,0,0,1,1,0,1,1,0,1,1,1,0,0,1,1,0,1,1,0,1,1,0,1},
    {1,1,0,0,1,0,1,0,0,0,1,1,1,1,1,0,0,0,1,0,0,1,1,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,1,0,0,1,1,0,1,1,0,1,1,1,0,0,0,1,0,1,1,0,1,1,0,1},
    {1,1,0,0,1,0,1,1,0,0,1,1,1,1,1,0,0,0,1,0,0,1,1,1,0,0,0,0,1,0,0,1,0,0,0,1,0,0,0,1,1,0,0,1,1,0,1,1,0,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1},
    {1,1,0,0,0,0,1,1,0,1,1,1,1,1,1,0,0,0,1,0,0,1,1,1,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,1,1,0,0,1,1,1,1,1,0,1,1,1,0,0,1,1,0,1,1,0,1,1,0,1},
    {1,1,0,0,1,0,1,1,0,1,1,1,1,1,1,0,0,0,1,0,0,1,1,1,0,0,0,0,1,0,0,0,0,1,0,1,0,0,0,1,1,0,0,1,1,0,0,1,0,1,1,1,0,0,1,1,0,1,1,0,1,1,0,1},
    {1,1,0,0,1,0,1,0,0,0,1,1,0,1,1,0,0,0,1,0,0,0,1,1,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,1,0,0,1,1,1,1,1,0,1,1,1,0,0,1,1,0,1,1,0,1,1,0,1},
    {1,1,0,0,1,0,1,0,0,0,1,1,1,1,1,0,0,0,1,0,1,0,1,1,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,1,0,0,0,1,0,1,1,0,1,1,1,0,0,1,1,0,1,1,0,1,1,0,1},
    {1,0,0,0,1,0,1,0,0,0,1,1,1,1,1,0,0,0,1,1,0,0,1,1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,1,0,0,1,1,0,1,1,0,1,1,1,0,0,1,1,0,1,1,0,1,1,0,1},
    {1,1,0,0,1,0,1,0,0,0,1,1,1,1,1,0,0,0,1,1,0,0,1,1,0,0,0,0,1,0,0,1,0,0,0,1,1,0,0,1,1,1,0,1,1,1,1,1,0,1,1,1,0,0,1,1,0,1,1,0,1,1,0,1},
    {1,1,0,0,1,0,1,0,0,0,1,1,1,1,1,0,0,0,1,1,0,0,1,1,0,0,0,0,1,0,0,0,0,1,0,1,0,0,0,1,1,0,0,1,0,0,1,1,0,1,1,1,0,0,1,1,0,1,1,0,1,1,0,0},
    {1,0,0,0,1,0,1,0,0,0,1,1,1,1,1,0,0,0,1,0,0,0,1,1,0,0,0,0,1,0,0,0,0,1,0,1,0,0,0,1,1,1,0,1,1,0,1,1,0,1,1,1,1,0,1,1,0,1,1,0,1,1,0,1},
    {1,0,0,0,1,0,1,0,0,0,1,1,1,1,1,0,0,0,1,1,0,0,1,1,0,0,0,0,1,0,0,0,0,1,0,1,0,0,0,1,1,0,0,1,1,0,1,1,0,1,1,0,0,0,1,0,0,1,1,0,0,1,0,1},
    {1,0,1,0,1,0,1,0,0,0,1,1,1,1,1,0,0,0,1,0,0,0,1,1,0,0,0,0,1,0,0,0,0,1,0,1,0,1,0,1,1,1,0,1,1,0,1,1,0,1,1,0,0,0,1,0,0,1,1,0,1,1,0,0},
    {1,1,0,0,1,0,1,0,0,0,0,1,1,1,1,0,0,0,1,0,0,0,1,1,0,0,0,0,1,0,0,0,0,1,0,1,0,1,0,1,1,0,0,1,1,0,1,1,0,1,1,0,0,0,1,1,0,1,1,0,1,1,0,1},
    {1,1,0,0,1,0,1,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,1,1,0,0,0,0,1,0,0,0,0,1,0,1,0,1,0,1,1,0,0,1,1,0,1,1,0,1,1,1,0,0,1,0,0,1,1,0,1,1,0,1},
    {1,1,0,1,1,0,1,0,0,0,1,1,1,1,1,0,0,0,1,0,0,0,1,0,0,0,1,0,1,0,0,0,0,1,0,1,0,0,0,1,1,0,0,1,1,0,1,1,0,1,1,1,0,0,1,0,0,0,1,0,1,1,0,1},
    {1,1,0,1,1,0,1,0,0,0,1,1,1,1,1,0,0,1,1,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,1,1,0,1,0,1,1,0,0,1,1,0,1,1,0,1,1,0,0,0,1,1,0,0,1,0,1,1,0,1},
    {1,1,0,1,1,1,1,0,0,0,1,1,1,1,1,0,0,1,1,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,0,1,0,0,0,1,1,0,1,1,1,0,1,1,0,1,1,1,0,0,1,1,0,1,1,0,1,1,0,1},
    {1,1,0,0,1,1,1,0,0,0,1,1,1,1,1,0,0,1,1,0,0,0,1,1,0,0,0,0,1,0,0,0,0,1,0,1,0,0,0,1,1,0,0,1,1,0,1,1,0,1,0,1,0,0,1,1,0,1,1,0,1,1,0,1},
    {1,1,0,1,1,0,1,0,0,0,1,1,1,1,1,0,0,1,1,0,0,0,1,1,0,0,0,1,1,0,0,0,0,1,0,1,0,0,0,0,1,0,0,1,1,0,1,1,0,0,1,1,0,0,1,1,0,1,0,0,1,1,0,1},
    {0,1,0,1,1,1,1,0,0,0,1,1,1,1,1,0,0,0,1,0,0,0,1,1,0,0,0,1,1,0,0,0,0,1,0,1,0,0,0,0,1,0,0,1,1,0,1,1,0,1,1,1,0,1,1,1,0,1,1,0,1,1,0,1},
    {1,1,0,0,1,0,1,0,1,0,1,1,1,1,1,0,0,0,1,0,0,0,1,1,0,0,0,1,1,0,0,0,0,1,0,1,0,0,0,0,1,0,0,1,1,0,1,1,0,0,1,1,0,0,1,1,0,1,1,0,1,1,0,1},
    {1,1,0,0,1,0,1,0,0,0,1,1,1,1,1,0,1,0,1,0,0,0,1,1,0,0,0,1,1,0,0,0,0,1,0,1,0,0,0,1,1,0,0,1,1,0,1,1,0,0,1,1,0,1,1,1,0,1,1,0,1,1,0,1},
    {1,1,0,0,1,0,1,0,0,0,1,1,1,0,1,1,0,0,1,0,0,0,1,1,1,0,0,0,1,0,0,0,0,1,0,1,0,0,0,0,1,0,0,1,1,0,1,1,0,0,1,1,0,0,1,1,0,1,1,0,1,0,0,1},
    {1,1,0,0,1,0,1,0,0,0,1,1,1,0,1,1,0,0,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,1,0,1,0,0,0,0,1,0,0,1,1,0,1,1,0,0,1,1,0,1,1,1,0,1,1,0,1,0,0,1},
    {1,1,0,0,1,0,1,0,0,0,1,1,1,1,1,1,0,0,1,0,0,0,1,1,0,0,0,0,1,0,0,0,0,1,0,1,0,0,0,1,0,0,0,1,1,0,1,1,0,1,1,1,0,0,1,1,0,1,1,1,1,0,0,1},
    {1,1,0,0,1,0,1,0,0,0,1,1,1,0,1,1,0,0,1,0,0,0,1,1,0,0,0,0,1,0,0,0,0,1,0,1,0,0,0,1,1,0,0,1,1,0,1,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,0,1},
    {1,1,0,0,1,0,1,0,0,0,1,1,1,0,1,1,0,0,1,0,0,0,1,1,0,1,0,0,1,1,0,0,0,1,0,1,0,0,0,1,1,0,0,1,1,0,1,0,0,1,1,1,0,0,1,1,1,1,1,1,1,0,0,1},
};

int IP_m[]=
{
	  58, 50, 42, 34, 26, 18, 10, 2,
	  60, 52, 44, 36, 28, 20, 12, 4,
	  62, 54, 46, 38, 30, 22, 14, 6,
	  64, 56, 48, 40, 32, 24, 16, 8,
	  57, 49, 41, 33, 25, 17,  9, 1,
	  59, 51, 43, 35, 27, 19, 11, 3,
	  61, 53, 45, 37, 29, 21, 13, 5,
	  63, 55, 47, 39, 31, 23, 15, 7
};
int Pinve[] = { 9, 17, 23, 31, 13, 28,  2, 18,
                24,16, 30,  6, 26, 20, 10,  1,
				8, 14, 25,  3,  4, 29, 11, 19,
				32, 12, 22,  7,  5, 27, 15, 21};

int Ex[] =
{	  32,  1,  2,  3,  4,  5,
	   4,  5,  6,  7,  8,  9,
	   8,  9, 10, 11, 12, 13,
	  12, 13, 14, 15, 16, 17,
	  16, 17, 18, 19, 20, 21,
	  20, 21, 22, 23, 24, 25,
	  24, 25, 26, 27, 28, 29,
	  28, 29, 30, 31, 32,  1
};





int S1_m[4][16] =
{
		{14,  4, 13,  1,  2, 15, 11,  8,  3, 10,  6, 12,  5,  9,  0,  7},
		{0, 15,  7,  4, 14,  2, 13,  1, 10,  6, 12, 11,  9,  5,  3,  8},
		{4,  1, 14,  8, 13,  6,  2, 11, 15, 12,  9,  7,  3, 10,  5,  0},
		{15, 12,  8,  2,  4,  9,  1,  7,  5, 11,  3, 14, 10,  0,  6, 13}
};

int S2_m[4][16] =
{
	{15,  1,  8, 14,  6, 11,  3,  4,  9,  7,  2, 13, 12,  0,  5, 10},
	 {3, 13,  4,  7, 15,  2,  8, 14, 12,  0,  1, 10,  6,  9, 11,  5},
	 {0, 14,  7, 11, 10,  4, 13,  1,  5,  8, 12,  6,  9,  3,  2, 15},
	{13,  8, 10,  1,  3, 15,  4,  2, 11,  6,  7, 12,  0,  5, 14,  9}
};

int S3_m[4][16] =
{
	{10,  0,  9, 14,  6,  3, 15,  5,  1, 13, 12,  7, 11,  4,  2,  8},
	{13,  7,  0,  9,  3,  4,  6, 10,  2,  8,  5, 14, 12, 11, 15,  1},
	{13,  6,  4,  9,  8, 15,  3,  0, 11,  1,  2, 12,  5, 10, 14,  7},
	 {1, 10, 13,  0,  6,  9,  8,  7,  4, 15, 14,  3, 11,  5,  2, 12}
};

int S4_m[4][16] =
{
	 {7, 13, 14,  3,  0,  6,  9, 10,  1,  2,  8,  5, 11, 12,  4, 15},
	{13,  8, 11,  5,  6, 15,  0,  3,  4,  7,  2, 12,  1, 10, 14,  9},
	{10,  6,  9,  0, 12, 11,  7, 13, 15,  1,  3, 14,  5,  2,  8,  4},
	 {3, 15,  0,  6, 10,  1, 13,  8,  9,  4,  5, 11, 12,  7,  2, 14}
};

int S5_m[4][16] =
{
	 {2, 12,  4,  1,  7, 10, 11,  6,  8,  5,  3, 15, 13,  0, 14,  9},
	{14, 11,  2, 12,  4,  7, 13,  1,  5,  0, 15, 10,  3,  9,  8,  6},
	 {4,  2,  1, 11, 10, 13,  7,  8, 15,  9, 12,  5,  6,  3,  0, 14},
	{11,  8, 12,  7,  1, 14,  2, 13,  6, 15,  0,  9, 10,  4,  5,  3}
};

int S6_m[4][16] =
{
	{12,  1, 10, 15,  9,  2,  6,  8,  0, 13,  3,  4, 14,  7,  5, 11},
	{10, 15,  4,  2,  7, 12,  9,  5,  6,  1, 13, 14,  0, 11,  3,  8},
	 {9, 14, 15,  5,  2,  8, 12,  3,  7,  0,  4, 10,  1, 13, 11,  6},
	 {4,  3,  2, 12,  9,  5, 15, 10, 11, 14,  1,  7,  6,  0,  8, 13}
};

int S7_m[4][16]=
{
	 {4, 11,  2, 14, 15,  0,  8, 13,  3, 12,  9,  7,  5, 10,  6,  1},
	{13,  0, 11,  7,  4,  9,  1, 10, 14,  3,  5, 12,  2, 15,  8,  6},
	 {1,  4, 11, 13, 12,  3,  7, 14, 10, 15,  6,  8,  0,  5,  9,  2},
	 {6, 11, 13,  8,  1,  4, 10,  7,  9,  5,  0, 15, 14,  2,  3, 12}
};

int S8_m[4][16]=
{
	{13,  2,  8,  4,  6, 15, 11,  1, 10,  9,  3, 14,  5,  0, 12,  7},
	 {1, 15, 13,  8, 10,  3,  7,  4, 12,  5,  6, 11,  0, 14,  9,  2},
	 {7, 11,  4,  1,  9, 12, 14,  2,  0,  6, 10, 13, 15,  3,  5,  8},
	 {2,  1, 14,  7,  4, 10,  8, 13, 15, 12,  9,  0,  3,  5,  6, 11}
};

	  int  PC1inv[] ={ 8, 16, 24, 56, 52, 44, 36,
								-1,  7, 15, 23, 55, 51, 43,
								35, -1,  6, 14, 22, 54,	50,
								42, 34, -1,  5, 13, 21,	53,
								49, 41, 33, -1,  4, 12,	20,
								28, 48, 40, 32, -1,  3, 11,
								19, 27, 47, 39, 31, -1,	 2,
								10, 18, 26, 46, 38, 30, -1,
								 1,  9, 17, 25, 45, 37, 29, -1};



int PC2inv[] ={ 5, 24,  7, 16,  6, 10, 20,
								18, -1, 12,  3, 15, 23,  1,
								 9, 19,  2, -1, 14, 22, 11,
								-1, 13,  4, -1, 17, 21,  8,
								47, 31, 27, 48, 35, 41, -1,
								46, 28, -1, 39, 32, 25, 44,
								-1, 37, 34, 43, 29, 36, 38,
								45, 33, 26, 42, -1, 30, 40};


int PC2_Inv[] = {
	5,	24,	7,	16,	6,	10,
	20,	18,	0,	12,	3,	15,
	23,	1,	9,	19,	2,	0,
	14,	22,	11,	0,	13,	4,
	0,	17,	21,	8,	47,	31,
	27,	48,	35,	41,	0,	46,
	28,	0,	39,	32,	25,	44,
	0,	37,	34,	43,	29,	36,
	38,	45,	33,	26,	42,	0,
	30,	 40
};



//int sanserror[]={1,1,0,0,1,0,1,0,0,0,1,1,1,1,1,0,0,0,1,0,0,0,1,1,0,0,0,0,1,0,0,0,0,1,0,1,0,0,0,1,1,0,0,1,1,0,1,1,0,1,1,1,0,0,1,1,0,1,1,0,1,1,0,1};


void expansion_function_m(int pos, int text, int EXPtext[]) // réalise l'expension de R15
{
	for (int i = 0; i < 48; i++)
		if (Ex[i] == pos + 1)
			EXPtext[i] = text;

}

int get_NumBox(){
    int i=0;

    for (i=0;i<32;i++)
        if(L16[i]!=L16Error[i])
            return i/4+1;
    return 0;
}

void shift_right(){

    int tab1[28],tab2[28],shit_tab1[28],shit_tab2[28];
    for(int i =0;i<28;i++)
        tab1[i]=TEMP_C2[i];
    for(int i =28;i<56;i++)
        tab2[i-28]=TEMP_C2[i];
    shit_tab1[0]=tab1[27];
    shit_tab2[0]=tab2[27];
    for(int i=1;i<28;i++){
        shit_tab1[i]=tab1[i-1];
        shit_tab2[i]=tab2[i-1];
    }


    for(int i =0;i<28;i++)
        TEMP_Shift[i]=shit_tab1[i];
    for(int i=0;i<28;i++)
        TEMP_Shift[28+i]=shit_tab2[i];

        for (int i=0; i<56;i++)
        printf("%d",TEMP_Shift[i]);printf(" kjlmkjmk\n");

}
void initialPermutation_m(int pos, int text)
{
	int i;
	for (i = 0; i < 64; i++)
		if (IP_m[i] == pos + 1)
			break;
	IPtext[i] = text;

}
void inverseP(int pos, int text)
{
	 int i;
	for (i = 0; i < 32; i++)
		if (Pinve[i] == pos + 1)
			break;
	Permute_Xor_Chiffre[i] = text;



}
void permutation2(int pos, int text)

{

        for (int i = 0; i <56 ; i++)
            if (PC2inv[i] == pos + 1){
                TEMP_C2[i] = text;
                break;
            }


}
void permutation1(int pos, int text)

{
         for (int i = 0; i <64 ; i++)
            if (PC1inv[i] == pos + 1){
                TEMP_C1[i] = text;
                break;
            }
}
void trouverR15(int chiffre[], int LEFT[], int RIGHT[])
{

	for (int i = 0; i < 64; i++)
		initialPermutation_m(i, chiffre[i]);


	for (int i = 0; i < 32; i++)
		RIGHT[i] = IPtext[i];

	for (int i = 32; i < 64; i++){
		LEFT[i - 32] = IPtext[i]; //R15;
	}

}
void splitR15to6(int position, int initial[],int split[]){
    int c= 6*(position-1);

    for(int i=c;i<=c+5;i++){
        split[i-c]=initial[i];
    }
}
void splitChiffreto4(int position){
    int c= 4*(position-1);

    for(int i=c;i<=c+3;i++){
        Split_Chiffre[i-c]=Permute_Xor_Chiffre[i];


    }


}

void add_to_K16(int recap[], int tab[][6], int i_k,int position){

    int index_max=0, max=0, change=0;

    for(int i=1;i<i_k;i++)
        if (recap[i]>=recap[max])
            max=i;

    for (int i=0; i<i_k;i++){

        if(recap[i]==recap[max]){
            index_max=i;
            change++;
    }

    }

    for(int j=6*(position-1);j<position*6;j++){
        K16[j]= tab[index_max][j- 6*(position-1)];
        }
}
void compare_ligne(int tab[][6],int i_k,int position){
    int k, recap[i_k], compt=0;
    for(int i=0;i<i_k;i++){
                    compt=0;

        for(int j=i+1;j<i_k;j++){
            for(k=0;k<6;k++){
                if(tab[i][k]!=tab[j][k])
                    break;
            }
            if(k==6){
               compt++;
            }
        }
        recap[i]=compt;
    }
    add_to_K16(recap, tab, i_k,position);
}

int F1_m(int i,int XORtext[])
{
	int r, c, b[6];
	for (int j = 0; j < 6; j++)
		b[j] = XORtext[j];

	r = b[0] * 2 + b[5];
	c = 8 * b[1] + 4 * b[2] + 2 * b[3] + b[4];
	if (i == 1)
		return S1_m[r][c];
	else if (i == 2)
		return S2_m[r][c];
	else if (i == 3)
		return S3_m[r][c];
	else if (i == 4)
		return S4_m[r][c];
	else if (i == 5)
		return S5_m[r][c];
	else if (i == 6)
		return S6_m[r][c];
	else if (i == 7)
		return S7_m[r][c];
	else if (i == 8)
		return S8_m[r][c];

    return 0;

}



void add_key(int key[],int keys[][6],int i){
    for(int c=0;c<6;c++)
        keys[i][c]=key[c];
}
void add_key_in_list(int i,int key[]){
    if (i == 1){
   		add_key(key,cle1,i_1);
		 i_1++;
    }
	else if (i == 2){
		add_key(key,cle2,i_2);
		 i_2++;
	}
	else if (i == 3){
		add_key(key,cle3,i_3);
		 i_3++;
	}
	else if (i == 4){
		add_key(key,cle4,i_4);
		 i_4++;
	}
	else if (i == 5){
		add_key(key,cle5,i_5);
		 i_5++;
	}
	else if (i == 6){
		add_key(key,cle6,i_6);
		 i_6++;
	}
	else if (i == 7){
		add_key(key,cle7,i_7);
		 i_7++;
	}
	else if (i == 8) {
        add_key(key,cle8,i_8);
        i_8++;
	}

}
int compare(){

    for(int i=0;i<4;i++)
        if(Split_Chiffre[i]!=XOR_After_Box[i])
            return 0;
    return 1;

}

int XOR_m(int a, int b)
{
	return (a ^ b);
}
void ToBits_m(int value,int OutText[])
{
	int k, j, m;

	for (j = 3; j >= 0; j--)
	{
		m = 1 << j;
		k = value & m;
		if (k == 0)
			OutText[3-j] = 0;
		else
			OutText[3-j] = 1;
	}

}

void Sbox_m(int inText[], int numbox, int OutText[])
{

	int value;
	value = F1_m(numbox,inText);

	ToBits_m(value,OutText);

}

////////////////Vérification clé

int verification(int key[]){
    key64to48(key);

    return Encryption();

}

int main()
{

    int xor_key[6], xor_key_erreur[6],minikey[6], avecerror[64];
    //////////////////////////////////////////////////////////dans une boucle Exp[48], ExpErreur[48];
    int IPsansFaute=0, num_box=0, k;
	if(IPsansFaute==0){

	    trouverR15(sanserror, L16, R16);

	    for (int i = 0; i < 32; i++)
            expansion_function_m(i, L16[i],Exp); //Expansion de L16
      IPsansFaute=1;


	}
    printf("\n \n \n                    Ziadath BABAEDJOU \n \n \n ");
     for(int j=0;j<32;j++){
        for(int i=0;i<64;i++)
            avecerror[i]=chiffre[j][i];

        trouverR15(avecerror, L16Error, R16Error);//Récupérer   L16 et R15
        num_box=get_NumBox();


//Xor des R16
        for(int c=0; c<32;c++)
           XOR_Chiffre[c]=XOR_m(R16Error[c],R16[c]);
    // P-1 du xor
        for(int z = 0; z < 32; z++)
           inverseP(z, XOR_Chiffre[z]);
    //Split sur Num_Box
        splitChiffreto4( num_box );



       for (int i = 0; i < 32; i++)
            expansion_function_m(i, L16Error[i],ExpErreur); //Expansion de L16

        splitR15to6(num_box,Exp,Split_R15);
        splitR15to6(num_box,ExpErreur,Split_R15_Error);


        for(int i=0;i<64;i++){
            for (int c = 5; c >=0; c--)
              {
                k = i >> c;
                if (k & 1)
                    minikey[c]=1;
                else
                    minikey[c]=0;
              }

            for (int c=0;c<6;c++){
                xor_key[c]=XOR_m(minikey[c],Split_R15[c]);
                xor_key_erreur[c]=XOR_m(minikey[c],Split_R15_Error[c]);

            }

       // passage dans la sbox

            Sbox_m(xor_key, num_box, After_Box);
            Sbox_m(xor_key_erreur, num_box, After_Box_Error);
    //xor des résultats


            for (int c=0;c<4;c++)
                XOR_After_Box[c]=XOR_m(After_Box[c],After_Box_Error[c]);

       //comparaison
            if(compare()==1){

                add_key_in_list(num_box,minikey);
            }
        }

    }
    for (int i=0; i<48;i++)
            K16[i]=0;
    for (int i=0; i<48;i++)
        compare_ligne(cle1,i_1,1);
        compare_ligne(cle2,i_2,2);
        compare_ligne(cle3,i_3,3);
        compare_ligne(cle4,i_4,4);
        compare_ligne(cle5,i_5,5);
        compare_ligne(cle6,i_6,6);
        compare_ligne(cle7,i_7,7);
        compare_ligne(cle8,i_8,8);



    printf("K16: ");
    for (int i=0; i<48;i++)
        printf("%d",K16[i]);
    printf("\n");

    for(int i=0;i<64; i++){
        if(i%8==7)
            K[i]=2; // case de bit de parité
        else
            K[i]=-1;

    }



    for (int i=0; i<56;i++)
       TEMP_C2[i]=-1;

    for (int i=0; i<64;i++)
            TEMP_C1[i]=2;

              for(int z = 0; z < 48; z++)
                    permutation2(z, K16[z]);


    for(int z = 0; z < 56; z++)
        permutation1(z, TEMP_C2[z]);    printf("\n");


    printf("\n\n                    Cle de 64 bits avec les bits manquant \n\n");

    for (int i=0; i<64;i++)
            printf("%d",TEMP_C1[i]);

        int i, t, j, m,co,l;
    for (i=0; i<256;i++){   ///////////////////////////////////////////////////////////////////////////
        t=j=m=l=0;
        for (j = 7; j >= 0; j--)
        {
            m = 1 << j;
            t = i & m;
            if (t == 0)
                K8[7-j] = 0;
            else
                K8[7-j] = 1;
        }
        t=0;

        for (int c=0;c<64;c++)
            K[c]=TEMP_C1[c];

        for (int c=0;c<64;c++)
            if(K[c]==-1){
                K[c]=K8[t];
                t++;
            }


        for (int c=0;c<64;c++){// Calcule des parités

            if(K[c]==2){
                m=0;
                for(int d=c-7;d<c;d++){
                    m=m+K[d];
                }
            if(m%2==0)
                K[c]=1;
            else
                K[c]=0;
                m=0;
            }

        }

        co=verification(K);
        if(co==1)
            break;
    }

    printf("\n \n \n                    La cle complete en bit: \n \n");
    for (int c=0;c<64;c++)
            printf("%d",K[c]);
 printf("\n\n");

    return 0;


}
